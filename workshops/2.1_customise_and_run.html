<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Customising &amp; running nf-core pipelines – Peter Mac Nextflow Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-fe31d7bd2deb2a321418d01dba375a64.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-a14e3238c51140e99ccc48519b6ed9ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Peter Mac Nextflow Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/00_setup.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Sessions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sessions">    
        <li>
    <a class="dropdown-item" href="../sessions/1_intro_run_nf.html">
 <span class="dropdown-text">Introduction to Nextflow and Nf-core</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/2_nf_dev_intro.html">
 <span class="dropdown-text">Developing bioinformatics workflows with Nextflow</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-workshop" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Workshop</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-workshop">    
        <li>
    <a class="dropdown-item" href="../workshops/1.1_intro_nextflow.html">
 <span class="dropdown-text">Introduction to Nextflow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/1.2_intro_nf_core.html">
 <span class="dropdown-text">Introduction to nf-core</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/2.1_customise_and_run.html">
 <span class="dropdown-text">Customising &amp; running nf-core pipelines</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/2.2_troubleshooting.html">
 <span class="dropdown-text">Troubleshooting Nextflow run</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/2.3_tips_and_tricks.html">
 <span class="dropdown-text">Best practise, tips and tricks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/3.1_creating_a_workflow.html">
 <span class="dropdown-text">Creating a workflow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/4.1_modules.html">
 <span class="dropdown-text">Modularisation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/5.1_nf_core_template.html">
 <span class="dropdown-text">Nf-core Template</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/6.1_operators.html">
 <span class="dropdown-text">Nextflow Operators</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/7.1_metadata_propagation.html">
 <span class="dropdown-text">Metadata Propagation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshops/8.1_scatter_gather_output.html">
 <span class="dropdown-text">Output, scatter, and Gather</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>Customising &amp; running nf-core pipelines</strong></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="pipeline-setup" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-setup"><strong>2.1.1. Pipeline setup</strong></h3>
<p>In this session we are using Singularity containers to manage software installation for all <code>nf-core/rnaseq</code> tools. Confirm the Singularity cache directory we set in the previous session using the <code>$NXF_SINGULARITY_CACHEDIR</code> <a href="https://www.nextflow.io/docs/latest/config.html#environment-variables">Nextflow environmental variable</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>echo $NXF_SINGULARITY_CACHEDIR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="emoji" data-emoji="eyes">👀</span> This should match the directory you set in the previous session:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>/config/binaries/singularity/containers_devel/nextflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="design-your-run-command" class="level3">
<h3 class="anchored" data-anchor-id="design-your-run-command"><strong>2.1.2. Design your run command</strong></h3>
<p>As we learnt in <a href="../workshops/1.2_intro_nf_core.html#viewing-parameters">lesson 1.2.4</a>, all nf-core pipelines have a unique set of pipeline-specific parameters that can be used in conjunction with Nextflow parameters to configure the workflow. Generally, nf-core pipelines can be customised at a few different levels:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<thead>
<tr class="header">
<th>Level of effect</th>
<th>Customisation feature</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>The workflow</td>
<td>Where diverging methods are available for a pipeline, you may choose a path to follow</td>
</tr>
<tr class="even">
<td>A process</td>
<td>Where more than one tool is available for a single step, you may choose which to use</td>
</tr>
<tr class="odd">
<td>A tool</td>
<td>Apply specific thresholds or optional flags for a tool on top of the default run command</td>
</tr>
<tr class="even">
<td>Compute resources</td>
<td>Specify resource thresholds or software execution methods for the workflow or a process</td>
</tr>
</tbody>
</table>
<p>All nf-core pipelines are provided with comprehensive documentation that explain what the default workflow structure entails and options for customising this based on your needs. It is important to remember that nf-core pipelines typically do not include all possible tool parameters. This makes it challenging to piece these different sources of information together to determine which parameters you should be using.</p>
<p>The following sections of the documentation can be used to understand what the pipeline is doing and inform your choices about aspects of pipeline-specific customisations:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Docs</th>
<th>Description</th>
<th>Customisation level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://nf-co.re/rnaseq/3.11.1">Introduction</a></td>
<td>Workflow summary</td>
<td><ul>
<li>workflow</li>
<li>process</li>
</ul></td>
</tr>
<tr class="even">
<td><a href="https://nf-co.re/rnaseq/3.11.1/usage">Usage</a></td>
<td>Inputs and options</td>
<td><ul>
<li>workflow</li>
<li>process</li>
</ul></td>
</tr>
<tr class="odd">
<td><a href="https://nf-co.re/rnaseq/3.11.1/parameters">Parameters</a></td>
<td>Available flags</td>
<td><ul>
<li>workflow</li>
<li>process</li>
<li>compute resources</li>
</ul></td>
</tr>
<tr class="even">
<td><a href="https://nf-co.re/rnaseq/3.11.1/output">Output</a></td>
<td>Files from all processes processes</td>
<td><ul>
<li>workflow</li>
<li>process</li>
<li>tool</li>
</ul></td>
</tr>
</tbody>
</table>
</section>
<section id="challenge" class="level3 unlisted">
<h3 class="unlisted anchored" data-anchor-id="challenge"><strong>Challenge</strong></h3>
<p>View the parameters for the <code>nf-core/rnaseq</code> workflow using the command line for the specific version <code>3.11.1</code></p>
<p>:::</p>
<section id="pipeline-structure" class="level4">
<h4 class="anchored" data-anchor-id="pipeline-structure"><strong>Pipeline structure</strong></h4>
<p><span class="emoji" data-emoji="eyes">👀</span> Looking at the nf-core/rnaseq pipeline structure provided in the <a href="https://nf-co.re/rnaseq/3.11.1">introduction</a>, we can see that the developers have:</p>
<ol type="1">
<li>Organised the workflow into 5 stages based on the type of work that is being done</li>
<li>Provided a choice of multiple methods and specified defaults</li>
<li>Provided a choice of tool for some steps</li>
</ol>
<p><img src="./media/2.1_pipeline-choice.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Thoughts? <span class="emoji" data-emoji="thought_balloon">💭</span></strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="emoji" data-emoji="question">❓</span> Observing the diagram above, which statement is true regarding the choice of alignment and quantification methods provided by the nf-core/rnaseq pipeline?</p>
<p><strong>a.</strong> The pipeline uses a fixed method for read alignment and quantification.<br>
<strong>b.</strong> Users can choose between several different methods for read alignment and quantification.<br>
<strong>c.</strong> The pipeline always performs read alignment and quantification using STAR or HISAT2.<br>
<strong>d.</strong> The choice of alignment and quantification method is determined automatically based on the input data.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The correct answer is <strong>b</strong>. The nf-core/rnaseq pipeline allows users to choose between pseudo-alignment and quantification or several different methods for genome-based read alignment and quantification.</p>
<ul>
<li>a is incorrect because the pipeline is not limited to a single method.<br>
</li>
<li>c is incorrect because while read alignment and quantification using STAR and Salmon are the default method, users can choose pseudo-alignment method.</li>
<li>d is also incorrect, as the pipeline only accepts fastq files as input and the choice of alignment and quantification method must be specified by the user.</li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="default-pipeline-usage" class="level3">
<h3 class="anchored" data-anchor-id="default-pipeline-usage"><strong>Default pipeline usage</strong></h3>
<p>The number and type of default and optional parameters an nf-core pipeline accepts is at the discretion of it’s developers. However, at a minimum, nf-core pipelines typically:</p>
<ul>
<li>Require users to specify a <a href="https://nf-co.re/rnaseq/3.11.1/usage#samplesheet-input">sample sheet</a> (<code>--input</code>) detailing sample data and relevant metadata</li>
<li>Autogenerate or acquire missing reference files from <a href="https://github.com/nf-core/rnaseq/blob/master/conf/igenomes.config">iGenomes</a> ( using the <code>--genome</code>) if not provided by the user.</li>
</ul>
<p>You can see the recommended (typical) run command and all the parameters available for the nf-core/rnaseq pipeline by running:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core/rnaseq -r 3.11.1 --help </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The typical or recommended run command for this pipeline is provided at the top of the screen:</p>
<p><img src="./media/2.1_default-command.png" class="img-fluid"></p>
<p>It outlines a requirement for a few basic things:</p>
<ul>
<li>An input samplesheet</li>
<li>A location to store outputs</li>
<li>Relevant reference data</li>
<li>A software management method</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Reminder: hyphens matter in Nextflow!</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nextflow-specific parameters use one (<code>-</code>) hyphen, whereas pipeline-specific parameters use two (<code>--</code>). In the typical run command above <code>-profile</code> is a <strong>Nextflow</strong> parameter, while <code>--input</code> is an <strong>nf-core</strong> parameter.</p>
</div>
</div>
<section id="required-input---input" class="level4">
<h4 class="anchored" data-anchor-id="required-input---input"><strong>Required input: <code>--input</code></strong></h4>
<p>Most of us will need to adjust the default run command for our experiments. Today we’ll be adjusting the typical nf-core/rnaseq run command by:</p>
<ol type="1">
<li>Providing our own reference files</li>
<li>Using the Singularity software management profile, instead of Docker</li>
<li>Customising the execution of some processes</li>
<li>Specifying the computing resource limitations of our instances (2 CPUs, 8 Gb RAM)</li>
</ol>
<p>Our input fastq files (<code>fastq/</code>), reference data (<code>ref/</code>), and full sample sheet (<code>samplesheet.csv</code>) are already available on the cluster. Take a look at the files:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ls -l /data/seqliner/test-data/rna-seq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>total 24</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>drwxrwsr-x 2 jyu bioinf-core 8192 Sep 14 10:13 ERCC_index</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>drwxrwsr-x 2 jyu bioinf-core 8192 Sep 14 10:12 fastq</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>drwxrwsr-x 2 jyu bioinf-core 8192 Sep 14 10:12 ref</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To make life easier store the path to our test data in a variable.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>materials=/data/seqliner/test-data/rna-seq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Given we are only testing the pipeline in this session, we only need to work with a couple of samples. Copy the first two samples from the full prepared sample sheet to a local version of the file:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>head -n 3 $materials/samplesheet.csv &gt; samplesheet.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cat samplesheet.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sample,fastq_1,fastq_2,strandedness</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>HBR_Rep1_ERCC,fastq/HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read1.fastq.gz,fastq/HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read2.fastq.gz,forward</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>HBR_Rep2_ERCC,fastq/HBR_Rep2_ERCC-Mix2_Build37-ErccTranscripts-chr22.read1.fastq.gz,fastq/HBR_Rep2_ERCC-Mix2_Build37-ErccTranscripts-chr22.read2.fastq.gz,forward</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="required-input-reference-data" class="level4">
<h4 class="anchored" data-anchor-id="required-input-reference-data"><strong>Required input: reference data</strong></h4>
<p>Many nf-core pipelines have a minimum requirement for reference data inputs. The input reference data requirements for this pipeline are provided in the <a href="https://nf-co.re/rnaseq/3.11.1/usage#reference-genome-files">usage documentation</a>. We can replace the <code>--genome</code> flag in the typical run command with our own files. To see what reference files we can specify using parameters, rerun the pipeline’s help command to view all the available parameters:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core/rnaseq -r 3.11.1 --help</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From the <strong>Reference genome options</strong> parameters, we will provide our own files using:</p>
<ul>
<li><code>--fasta $materials/ref/chr22_with_ERCC92.fa</code><br>
</li>
<li><code>--gtf $materials/ref/chr22_with_ERCC92.gtf</code></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Beware the hidden parameters!</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice the message at the bottom of the screen:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>!! Hiding 24 params, use --show_hidden_params to show them !!</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Keep in mind that both this help command and the nf-core parameters documentation hides less common parameters.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Challenge</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Re-run the help command to output the parameters for the <code>nf-core/rnaseq</code> pipeline and including all hidden parameters for version <code>3.11.1</code></p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Run the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core/rnaseq -r 3.11.1 --help --show_hidden_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="optional-parameters" class="level3">
<h3 class="anchored" data-anchor-id="optional-parameters"><strong>Optional parameters</strong></h3>
<p>Now that we have prepared our input and reference data, we will customise the typical run command by:</p>
<ol type="1">
<li>Using Nextflow’s <code>-profile</code> parameter to specify that we will be running the Singularity profile instead of the Docker profile</li>
<li>Adding additional process-specific flags to <a href="https://nf-co.re/rnaseq/3.11.1/parameters#skip_markduplicates">skip duplicate read marking</a>, <a href="https://nf-co.re/rnaseq/3.11.1/parameters#save_trimmed">save trimmed reads</a> and <a href="https://nf-co.re/rnaseq/3.11.1/parameters#save_unaligned">save unaligned reads</a></li>
<li>Adding additional max resource flags to specify the <a href="https://nf-co.re/rnaseq/3.11.1/parameters#max_cpus">number of CPUs</a> and <a href="https://nf-co.re/rnaseq/3.11.1/parameters#max_memory">amount of memory</a> available to the pipeline.</li>
</ol>
<p>The parameters we will use are:</p>
<ul>
<li><code>-profile singularity</code></li>
<li><code>--skip_markduplicates true</code></li>
<li><code>--save_trimmed true</code></li>
<li><code>--save_unaligned true</code></li>
<li><code>--max_memory '6.GB'</code></li>
<li><code>--max_cpus 2</code></li>
</ul>
<p>You can see how we’ve customised the typical run command in the diagram below:</p>
<p><img src="./media/2.1_custom-command.png" class="img-fluid"></p>
</section>
<section id="run-the-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="run-the-pipeline"><strong>2.1.3. Run the pipeline</strong></h3>
<p>We will also create a separate output directory for this section.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cd /scratch/users/&lt;your-username&gt;/nfWorkshop; mkdir ./lesson2 &amp;&amp; cd $_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that we have prepared our data and chosen which parameters to apply, run the pipeline:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core/rnaseq -r 3.11.1 \</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    --input samplesheet.csv \</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    --outdir ./lesson2.1 \</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    --fasta $materials/ref/chr22_with_ERCC92.fa \</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    --gtf $materials/ref/chr22_with_ERCC92.gtf \</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    -profile singularity \</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    --skip_markduplicates true \</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    --save_trimmed true \</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    --save_unaligned true \</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    --max_memory '6.GB' \</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    --max_cpus 2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="emoji" data-emoji="eyes">👀</span> Take a look at the stdout printed to the screen. Your workflow configuration and parameter customisations are all documented here. You can use this to confirm if your parameters have been correctly passed to the run command:</p>
<p><img src="./media/2.1_nf-core-stdout.png" class="img-fluid"></p>
<p>As the workflow starts, you will also see a number of processes spawn out underneath this. Recall from the earlier session that processes are executed independently and can run in parallel. Nextflow manages the data dependencies between processes, ensuring that each process is executed only when its input data is available and all of its dependencies have been satisfied.</p>
<p>To understand how this is coordinated, consider the STAR_ALIGN process that is being run.</p>
<p><img src="./media/2.1_nf-core_processes.png" class="img-fluid"></p>
<p><span class="emoji" data-emoji="eyes">👀</span> You’ll notice a few things:</p>
<ul>
<li>We can see which inputs are being processed by looking at the end of the process name</li>
<li>When a process starts it progressively spawns tasks for all inputs to be processed</li>
<li>A single TRIMGALORE process is run across both samples in our <code>samplesheet.csv</code> before STAR_ALIGN begins</li>
<li>Once a TRIMGALORE task is completed for a sample, the STAR_ALIGN task for that sample begins</li>
<li>When the STAR_ALIGN process starts, it spawns 2 tasks.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall from <a href="../workshops/1.2_intro_nf_core.html#parameter-files">earlier</a> Convert the parameter definitions into a YAML file, <code>workshop-params.yaml</code>, compatible with <code>-params-file</code></p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb15"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>gtf: "/data/seqliner/test-data/rna-seq/ref/chr22_with_ERCC92.gtf"</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fasta: "/data/seqliner/test-data/rna-seq/ref/chr22_with_ERCC92.fa"</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>skip_markduplicates: true</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>save_trimmed: true</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>save_unaligned: true</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>max_memory: "6.GB" </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>max_cpus: 2</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>input: "samplesheet.csv"</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Key points</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>nf-core pipelines are provided with sensible default settings and required inputs.</li>
<li>An nf-core pipeline’s Usage, Output, and Parameters documentation can be used to design a suitable run command.</li>
<li>Parameters can be used to customise the workflow, processes, tools, and compute resources.<br>
</li>
</ul>
</div>
</div>
<p>In the previous exercises, we have explored how to customise a run with <strong>workflow parameters</strong> on the command line or within a parameters file. In this lesson we will now look at <strong>configuration settings</strong>, which manage <strong>how the workflow is implemented on your system</strong>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nextflow’s portability is achieved by separating <strong>workflow implementation</strong> (input data, custom parameters, etc.) from the <strong>configuration settings</strong> (tool access, compute resources, etc.) required to execute it. This portability facilitates <strong>reproducibility</strong>: by applying the same parameters as a colleague, and adjusting configurations to suit your platform, you can achieve the same results on any machine with no requirement to edit the code.</p>
</div>
</div>
</section>
<section id="default-nf-core-configuration" class="level3">
<h3 class="anchored" data-anchor-id="default-nf-core-configuration"><strong>2.1.4. Default nf-core configuration</strong></h3>
<p>Together <code>nextflow.config</code> and <code>base.config</code>, define the default execution settings and parameters of an nf-core workflow.</p>
<p>Let’s take a look at these two configuration files to gain an understanding of how defaults are applied. <a href="https://github.com/nf-core/rnaseq/blob/3.11.1/conf/base.config">conf/base.config</a></p>
<p>The generic <code>base.config</code> sets the default <strong>compute resource settings</strong> to be used by the processes in the nf-core workflow. It uses process labels to enable different sets of resources to be applied to groups of processes that require similar compute. These labels are specified within the <code>main.nf</code> file for a process.</p>
<p><span style="color:#000080;"> We can over-ride these default compute resources using a custom configuration file.</span></p>
<p>Then take a few moments to look through <a href="https://github.com/nf-core/rnaseq/blob/3.11.1/nextflow.config">workflow/nextflow.config</a></p>
<p>The <code>nextflow.config</code> file is more <strong>workflow-specific</strong>, and sets the <strong>defaults for the workflow parameters</strong>, as well as defines profiles to change the default <strong>software access</strong> from <code>$PATH</code> to the specified access method, eg Singularity.</p>
<p><span style="color:#000080;"> We can over-ride these parameters on the command line or with a parameters file, and over-ride the default behaviour of searching for tools on <code>$PATH</code> by specifying a <code>-profile</code>.</span></p>
<p>Default settings for <code>--max_cpus</code>, <code>--max_memory</code> and <code>--max_time</code> are applied within the nf-core <code>workflow/nextflow.config</code>. These are generous values expecting to be over-ridden with your custom settings, to ensure that no single process attempts to use more resources than you have available on your platform.</p>
<p>Within <code>workflow/conf/base.config</code>, the <code>check_max()</code> function over-rides the process resources <em>if the custom ‘max’ setting is lower than the default setting for that process</em>.</p>
<p><img src="./media/2.3_check_max.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenge
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>What are the default settings for CPU, memory and walltime for the <code>STAR_ALIGN</code> module?</li>
<li>How have these defaults been changed from our applied customisations in the previous runs?</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To uncover these answers, we need to understand what <strong>process label</strong> has been assigned to the <code>STAR_ALIGN</code> <a href="https://github.com/nf-core/rnaseq/blob/3.11.1/modules/nf-core/star/align/main.nf">module</a>.</p>
<p><code>STAR_ALIGN</code> has the label <code>process_high</code> which has the settings 12 CPUs, 72 GB mem, 16 hrs walltime applied by the default <code>base.config</code>. We have previosuly applied <code>--max_cpus 2</code> and <code>--max_memory 6.GB</code>, so the <code>check_max()</code> function would have reduced the resources given to the STAR alignment process to 2 CPUs and 6 GB RAM, while retaining the default max walltime.</p>
</div>
</div>
</div>
</section>
<section id="when-to-use-a-custom-config-file" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-a-custom-config-file"><strong>2.1.5. When to use a custom config file</strong></h3>
<p>In our runs so far, we have avoided the need for a custom resource configuration file by:</p>
<ul>
<li>Over-riding the default tool access method of <code>$PATH</code> by specifying the <code>singularity</code> profile defined in <code>workflow/nextflow.config</code>
<ul>
<li>Without this, our runs for this workshop would fail because we do not have the workflow tools (eg STAR, salmon) installed locally on our VMs</li>
</ul></li>
<li>Over-riding the default values for CPUs and memory set in <code>nextflow.config</code> with <code>--max_cpus 2</code> and <code>--max_memory 6.GB</code> to fit within our interactive sessions
<ul>
<li>Without these parameters, our runs would fail at the first process that requests more than this, because Nextflow workflows check that the requested resources are available before attempting to execute a workflow</li>
</ul></li>
</ul>
<p>These are basic configurations. What if:</p>
<ul>
<li>We wanted to increase the resources used above what is requested with process labels to take advantage of high CPU or high memory infrastructures?</li>
<li>We wanted to run on a HPC or cloud infrastructure?</li>
<li>We wanted to execute specific modules on specific node types on a cluster?</li>
<li>We wanted to use a non-default software container?</li>
<li>We wanted to customise outputs beyond what was possible with the nf-core workflow parameters?</li>
</ul>
</section>
<section id="custom-resource-configuration-using-process-labels" class="level3">
<h3 class="anchored" data-anchor-id="custom-resource-configuration-using-process-labels"><strong>2.1.6. Custom resource configuration using process labels</strong></h3>
<p>Capping workflow resources using the <code>max</code> parameters is a bit of a blunt instrument.</p>
<p>To achieve optimum computational efficiency on your platform, more granular control may be required.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you appled <code>--max_cpus 16</code> to the nf-core rnaseq workflow, the STAR_ALIGN module would still only utilise 12 CPUs, as this module (as we learnt in 2.1.5) has the label <code>process_high</code> which sets CPUs to 12.</p>
<p>If there were no processes with fulfilled input channels that could make use of the 4 remaining CPUs, those resources would sit idle until the STAR_ALIGN process had completed.</p>
<p>Optimisation for this platform might for example set <code>max_cpus</code> to 8 so two samples could be aligned concurrently, or over-ride the CPU resources assigned to the STAR_ALIGN module to 16.</p>
</div>
</div>
</div>
<p>The next two lessons will demonstrate how to achieve this using custom configuration files that fine-tune resources using <code>process labels</code> to assign the same resources to groups of processes sharing the same label, or <code>withName</code> to target specific processes.</p>
<p>In order to do this, we need to use the <code>process</code> scope. Nextflow has a number of different <a href="https://www.nextflow.io/docs/latest/config.html"><code>scopes</code></a> that can be included in configuration files, for example the <code>params</code> scope you covered in <a href="../workshops/1.2_intro_nf_core.html#parameters-in-the-command-line">lesson 1.2.5</a> and applied to your config in lesson 2.1.8.</p>
<p>Within the <code>process</code> scope, we can configure resources and additional arguments for processes.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following exercise is trivial given the limitations of our interactive session. Consider how this approach can be really powerful when working on HPC or cloud infrastructures, where the <a href="https://www.nextflow.io/docs/latest/executor.html"><code>executor</code></a> and <a href="https://www.nextflow.io/docs/latest/process.html#queue"><code>queue</code></a> directives enable you to take full advantage of the compute resources available on your platform.</p>
</div>
</div>
<p><br></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><span class="emoji" data-emoji="bulb">💡</span> View the file <a href="https://github.com/nf-core/rnaseq/blob/3.11.1/conf/base.config">conf/base.config</a> for syntax example</li>
<li>Add a <code>process</code> scope inside the <code>my_resources.config</code></li>
<li>Use <code>withLabel: &lt;label_name&gt;</code> to set resources for each of the following labels:
<ul>
<li><code>process_low</code></li>
<li><code>process_medium</code></li>
<li><code>process_high</code></li>
</ul></li>
</ul>
</div>
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    withLabel: process_low {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    withLabel: process_medium {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    withLabel: process_high {</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Save the file then re-run the workflow with our custom configuration, setting <code>outdir</code> parameter to <code>lesson2.1.7</code>:</p>
</section>
<section id="examine-the-outputs" class="level3">
<h3 class="anchored" data-anchor-id="examine-the-outputs"><strong>2.1.7. Examine the outputs</strong></h3>
<p>Once your pipeline has completed, you should see this message printed to your terminal:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>-[nf-core/rnaseq] Pipeline completed successfully with skipped sampl(es)-</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>-[nf-core/rnaseq] Please check MultiQC report: 2/2 samples failed strandedness check.-</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Completed at: 21-Nov-2023 03:31:24</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>Duration    : 10m 50s</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>CPU hours   : 0.3</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>Succeeded   : 67</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The pipeline ran successfully, however, note the warning about all samples having failed the strandedness check. We’ll explore that in the next section.</p>
<p>In the meantime, list (<code>ls -la</code>) the contents of your directory, you’ll see a few new directories (and a hidden directory and log file) have been created:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>total 356</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>drwxrwxr-x  6 rlupat rlupat   4096 Nov 22 03:33 .</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>drwxrwxr-x  7 rlupat rlupat   4096 Nov 22 03:14 ..</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>drwxrwxr-x  7 rlupat rlupat   4096 Nov 22 03:31 lesson2.1</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>drwxrwxr-x  4 rlupat rlupat   4096 Nov 22 03:31 .nextflow</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>-rw-rw-r--  1 rlupat rlupat 283889 Nov 22 03:31 .nextflow.log</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>-rw-rw-r--  1 rlupat rlupat  66150 Nov 22 03:20 .nextflow.log.1</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>-rw-rw-r--  1 rlupat rlupat    492 Nov 22 03:15 samplesheet.csv</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>drwxrwxr-x 69 rlupat rlupat   4096 Nov 22 03:29 work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="emoji" data-emoji="eyes">👀</span> Nextflow has created 2 new output directories, <strong>work</strong> and <strong>lesson2.1</strong> in the current directory.</p>
<section id="the-work-directory" class="level4">
<h4 class="anchored" data-anchor-id="the-work-directory">The <code>work</code> directory</h4>
<p>As each job is run, a unique sub-directory is created in the <code>work</code> directory. These directories house temporary files and various command logs created by a process. We can find all information regarding this process that we need to troubleshoot a failed process.</p>
</section>
<section id="the-lesson2.1-directory" class="level4">
<h4 class="anchored" data-anchor-id="the-lesson2.1-directory">The <code>lesson2.1</code> directory</h4>
<p>All final outputs will be presented in a directory specified by the <code>--outdir</code> flag.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Before executing this run command
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you haven’t done so already, check that the run from lession 2.1.3 has completed successfully.</p>
<p>You run should have a summary message similar to below:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>-[nf-core/rnaseq] Pipeline completed successfully with skipped sampl(es)-</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>-[nf-core/rnaseq] Please check MultiQC report: 2/2 samples failed strandedness check.-</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>Completed at: 11-May-2023 13:21:50</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>Duration    : 7m 8s</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>CPU hours   : 0.2</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>Succeeded   : 66</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>with the following output directories:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>$ ls lesson2.1</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fastqc  multiqc  pipeline_info  star_salmon  trimgalore</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="sourceCode" id="cb21"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core/rnaseq -r 3.11.1 \</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  -profile singularity</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  -c my_resources.config \</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  --outdir lesson2.1.6 \</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  -resume</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="emoji" data-emoji="eyes">👀</span> Notice that the <strong>Max job request options</strong> are no longer listed on the run log printed to screen, because we are setting them within the <code>process</code> scope rather than <code>params</code> scope.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Configuration order of priority
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <a href="https://www.nextflow.io/docs/latest/config.html#configuration-file">order of priority</a> in which parameters and configurations are applied by Nextflow.</p>
<p>The settings we specify with <code>-c my_resources.config</code> will over-ride those that appear in the default nf-core configurations <code>workflow/nextflow.config</code> and <code>workflow/conf/base.config</code>.</p>
<p>Settings that are not over-ridden by <code>-c &lt;config&gt;</code> or any parameter from params file or provided on the command line will still be set to the nf-core defaults specified in <code>nextflow.config</code>, <code>base.config</code> or <code>main.nf</code>.</p>
<p>To avoid confusion, it is best not to name your custom configuration files <code>nextflow.config</code>!</p>
</div>
</div>
</section>
</section>
<section id="custom-resource-configuration-using-process-names" class="level3">
<h3 class="anchored" data-anchor-id="custom-resource-configuration-using-process-names"><strong>2.1.8. Custom resource configuration using process names</strong></h3>
<p>This exercise will demonstrate how to adjust the resource configurations for a specific process using the <code>withName</code> process selector, using the STAR_ALIGN module as example.</p>
<p><code>withName</code> is a powerful tool:</p>
<ul>
<li>Specifically target individual modules</li>
<li>Multiple module names can be supplied using wildcards or ‘or’ (<code>*</code> or <code>|</code>) notation</li>
<li>No need to edit the module <code>main.nf</code> file to add a process label</li>
<li>Has a <a href="https://www.nextflow.io/docs/latest/config.html#selector-priority">higher priority</a> than <code>withLabel</code></li>
</ul>
<p>To utilise <code>withName</code>, we first need to ensure we have the correct and specific <strong>executuion path</strong> for the module/modules that we wish to target.</p>
<p>Identify the execution path for the STAR_ALIGN module:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Finding the module execution path
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>The extended execution path is built from the pipeline, workflow, subworkflow, and module names</li>
<li>It can be tricky to evaluate the path used to execute a module. If you are unsure of how to build the path you can copy it from the <a href="https://github.com/nf-core/rnaseq/blob/3.11.1/conf/modules.config">view the modules.conf file on Github</a></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Note that this does not provide the PIPELINE or WORKFLOW name at the front of the path. You can add these manually (eg <code>PIPELINE</code> is NFCORE_RNASEQ and <code>WORKFLOW</code> is RNASEQ) but the path within <code>modules.config</code> is usually all that is required for specificity within a workflow</li>
<li>If you have previously run the pipeline, you could also extract the complete module execution path from your run log printed to screen, or the execution trace, timeline or report files within <code>&lt;outdir&gt;/pipeline_info</code></li>
</ul>
</div>
</div>
<p>For STAR_ALIGN within the <code>nf-core/rnaseq</code> workflow, any of the following would be correct and specific:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>'NFCORE_RNASEQ:RNASEQ:ALIGN_STAR:STAR_ALIGN'</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>'.*:RNASEQ:ALIGN_STAR:STAR_ALIGN'</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>'.*:ALIGN_STAR:STAR_ALIGN'</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br><br></p>
<p>Continue editing <code>my_resources.config</code>. Inside the <code>process</code> scope, provide the execution path for the STAR_ALIGN module to the <code>withName</code> selector:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  withName: '.*:RNASEQ:ALIGN_STAR:STAR_ALIGN' {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>}      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Then set CPU to 24 and memory to 96 GB:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  withName: '.*:RNASEQ:ALIGN_STAR:STAR_ALIGN' {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    cpus = 24</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    memory = 96.GB</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Completed config file
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb25"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    withLabel: process_low {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    withLabel: process_medium {</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    withLabel: process_high {</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    withName: '.*:RNASEQ:ALIGN_STAR:STAR_ALIGN' {</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        cpus = 24</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        memory = 96.GB</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>What if the parameter I want to apply isn’t available?</strong>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Recall from <a href="../workshops/2.1_customise_and_run.html#custom-configuration-files">earlier</a> that nf-core modules use <code>ext.args</code> to pass additional arguments to a module. This uses a special Nextflow directive <a href="https://www.nextflow.io/docs/latest/process.html#ext"><code>ext</code></a>. If an nf-core pipeline does not have a pre-defined parameter for a process, you may be able to implement <code>ext.args</code>.</p>
<p>The inclusion of <code>ext.args</code> is currently best practice for all DSL2 nf-core modules where additional parameters may be required to run a process. However, this may not be implemented for all modules in all nf-core pipelines. Depending on the pipeline, these process modules may not have defined the <code>ext.args</code> variable in the script blocks and is thus not available for applying customisation. If that is the case consider submitting a feature request or a making pull request on the pipeline’s GitHub repository to implement this!</p>
</div>
</div>
</div>
<p>Save the config then resume your run, setting <code>outdir</code> to <code>lesson2.1.8</code>, applying your custom resources from <code>my_resources.config</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core/rnaseq -r 3.11.1 \</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  -profile singularity \</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  -c my_resources.config \</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  --outdir lesson2.1.8 \</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  -resume </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If your execution path for the STAR_ALIGN module was specified correctly, your run should have died with the error shown below because Nextflow checks that the resources requested are available before executing a workflow:</p>
<p><img src="./media/2.3_star_failed_resources.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Thoughts? <span class="emoji" data-emoji="thought_balloon">💭</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do you expect would happen to your run if your execution path for the STAR_ALIGN module was <strong>not</strong> specified correctly?</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In this case, our pipeline would complete OK, because the resources for the STAR_ALIGN process have been appropriately set for our interactive session using the <code>process_high</code> label within our <code>my_resources.config</code>.</p>
<p>The directives set within the <code>withName</code> scope would not be applicable, and a warning would be printed, eg</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>WARN: There's no process matching config selector: .*:RNASEQ:ALIGN_STAR:STARALIGN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Challenge</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Change the container used by multiqc to <code>quay.io/biocontainers/multiqc:1.14--pyhdfd78af_0</code> using the <code>withName</code> scope in your <code>my_resources.config</code></p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>my_resources.config</code></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>process {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    withLabel: process_low {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    withLabel: process_medium {</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    withLabel: process_high {</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        cpus = 2</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        memory = 6.GB</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    withName: '.*:MULTIQC' {</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        container = "quay.io/biocontainers/multiqc:1.14--pyhdfd78af_0"</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Run the pipeline</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>nextflow run nf-core/rnaseq -r 3.11.1 \</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  -profile singularity \</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  -c my_resources.config \</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  -params-file workshop-params.yaml \</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  --outdir lesson2.1.8 \</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  -resume </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Key points</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>nf-core workflows work ‘out of the box’ but there are compute and software configurations we should customise for our runs to work well on our compute infrastructure</li>
<li>nf-core executes by default with <code>workflow/nextflow.config</code> and <code>workflow/conf/base.config</code> and has a repository of community-contributed institutional config that ship with the workflow</li>
<li>custom config can be applied to a run with <code>-c &lt;config_name&gt;</code>, and will over-ride settings in the default config</li>
<li>customisations can be targeted to specific processes using <code>withLabel</code> or <code>withName</code></li>
<li>workflow parameters belong in <code>-params-file &lt;params_file&gt;</code> and not <code>-c &lt;custom_config&gt;</code></li>
</ul>
</div>
</div>
<hr>
<p><sup><em>These materials are adapted from <a href="https://sydney-informatics-hub.github.io/customising-nfcore-workshop/notebooks/1.2_nfcore.html">Customising Nf-Core Workshop</a> by Sydney Informatics Hub</em></sup></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/PMCC-BioinformaticsCore\.github\.io\/nextflow-nf-core-workshop-2025\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>